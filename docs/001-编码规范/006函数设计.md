第六章 函数设计
====

6.1 参数的规则
----

`【规则6-1-1】`参数的书写要完整，不要贪图省事。

`【规则6-1-2】`参数命名要恰当，顺序要合理。

例如编写字符串拷贝函数`stringCopy`，它有两个参数。如果把参数名字起为`$str1`和`$str2`，例如
```php
function stringCopy($str1, $str2);
```

那么我们很难搞清楚究竟是把str1拷贝到str2中，还是刚好倒过来。

可以把参数名字起得更有意义，如叫$strSource和$strDestination。这样从名字上就可以看出应该把$strSource拷贝到$strDestination。

还有一个问题，这两个参数那一个该在前那一个该在后？参数的顺序要遵循程序员的习惯。一般地，应将目的参数放在前面，源参数放在后面。

如果将函数声明为：
```php
function stringCopy($strSource, $strDestination);
```
别人在使用时可能会不假思索地写成如下形式：
```php
function stringCopy($str, “Hello World”); // 参数顺序颠倒
```

`【规则6-1-4】`在PHP5.2及以上版本里，对象的传递默认是以引用方式存在的，无需用& 。 

`【建议6-1-1】`避免函数有太多的参数，参数个数尽量控制在5个以内。如果参数太多，在使用时容易将参数类型或顺序搞错。


`【建议6-1-2】`尽量不要使用类型和数目不确定的参数。

C标准库函数printf是采用不确定参数的典型代表，其原型为：
```c
int printf(const chat *format[, argument]…);
```

这种风格的函数在编译时丧失了严格的类型安全检查。

<br>
<br>

6.2 返回值的规则 
----
`【建议6-2-1】`有时候函数原本不需要返回值，但为了增加灵活性如支持链式表达，可以附加返回值。

比如 
```php
function setTimezone()
{
  ……
  return $this;
}
```
<br>
<br>

6.3 函数内部实现的规则
----
  不同功能的函数其内部实现各不相同，看起来似乎无法就“内部实现”达成一致的观点。但根据经验，我们可以在函数体的“入口处”和“出口处”从严把关，从而提高函数的质量。

 
`【规则6-3-1】`在函数体的“入口处”，对参数的有效性进行检查。
很多程序错误是由非法参数引起的

`【规则6-3-2】`在函数体的“出口处”，对return语句的正确性和效率进行检查。

     如果函数有返回值，那么函数的“出口处”是return语句。我们不要轻视return语句。如果return语句写得不好，函数要么出错，要么效率低下。

6.4 其它建议
----

`【建议6-4-1】`函数的功能要单一，不要设计多用途的函数。

`【建议6-4-2】`函数体的规模要小，尽量控制在50行代码之内。

`【建议6-4-3】`尽量避免函数带有“记忆”功能。相同的输入应当产生相同的输出。

带有“记忆”功能的函数，其行为可能是不可预测的，因为它的行为可能取决于某种“记忆状态”。这样的函数既不易理解又不利于测试和维护。函数的`static`局部变量是函数的“记忆”存储器。建议尽量少用`static`局部变量，除非必需。

`【建议6-4-4】`不仅要检查输入参数的有效性，还要检查通过其它途径进入函数体内的变量的有效性，例如全局变量、文件句柄等。

`【建议6-4-5】`用于出错处理的返回值一定要清楚，让使用者不容易忽视或误解错误情况。
